// Generator - Creates the Prisma Client
generator client {
  provider = "prisma-client-js"
}

// Datasource - Tells prisma where our database is
datasource db {
  provider = "postgresql" // We are using PostgreSQL
  url      = env("DATABASE_URL") // Read connection string from .env
}

// User model - Represents a registered user
model User {
  id        Int   @id @default(autoincrement())
  name      String
  phone     String   @unique
  email     String?
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @default(now()) @updatedAt

  // Relationships - How this table connects to others
  contacts  Contact[] // One user can have many contacts
  spamReports SpamReport[] @relation("UserSpamReports") // One user can report many spam numbers 

  // Indexes - Make searches faster
  @@index([phone])  // Index on phone for quick lookups
  @@index([name])   // Index on name for search functionality
}

// Contact Model - Represents entries in a user's phone book
model Contact {
  id      Int @id @default(autoincrement())
  ownerId   Int
  name    String
  phone   String

  // Relationship to User
  owner   User   @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  // fields: [ownerId] = This column in Contact table
  // references: [id] = Points to id column in User table
  // onDelete: Cascade = If user is deleted, delete their contacts too

  @@index([ownerId])  // Fast lookup: "Get all contacts for user X"
  @@index([phone])    // Fast lookup: "Find contacts with this phone"
  @@index([name])     // Fast lookup: "Search contacts by name"
}

// SpamReport Model - Tracks who marked which number as spam
model SpamReport {
  id         Int   @id @default(autoincrement())
  phone      String
  reportedBy Int
  createdAt  DateTime @default(now())

  // Relationship to User
  reporter User @relation("UserSpamReports", fields: [reportedBy], references: [id], onDelete: Cascade)

  // Composite unique constraint - Same user can't report same number twice
  @@unique([phone, reportedBy])
  
  @@index([phone])  // Fast lookup: "How many reports for this number?"
}
